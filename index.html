<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>한살림 & 초록마을 서울 통합 지도 (Final)</title>
    
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCd6QIRzWvsTTbfVUQkcqGyz-fXuQ4DTbU"></script>
    
    <style>
        html, body { margin: 0; padding: 0; height: 100%; font-family: 'Pretendard', 'Malgun Gothic', sans-serif;}
        #map { width: 100%; height: 100%; }
        
        /* 범례 스타일 */
        .legend-container {
            position: absolute; bottom: 25px; left: 10px; z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px; border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            font-size: 11px; width: 130px;
            backdrop-filter: blur(5px);
        }
        .legend-title { font-weight: 800; margin-bottom: 8px; border-bottom: 1px solid #eee; padding-bottom: 5px; color:#333; }
        .legend-item { display: flex; align-items: center; margin-bottom: 4px; color:#555; }
        .legend-icon { width: 18px; height: 18px; margin-right: 6px; }
        
        /* 로딩 상태 표시줄 */
        #status-msg {
            position: absolute; top: 60px; left: 50%; transform: translateX(-50%);
            z-index: 1000; background: rgba(39, 174, 96, 0.9); color: white;
            padding: 8px 20px; border-radius: 20px; font-size: 13px; font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: none; transition: opacity 0.5s;
        }
    </style>
</head>
<body>
    <div id="status-msg">초록마을 매장 찾는 중... (0/75)</div>

    <div class="legend-container">
        <div class="legend-title">매장 범례</div>
        <div class="legend-item"><img src="http://maps.google.com/mapfiles/ms/icons/blue-dot.png" class="legend-icon"> 한살림 (북서울)</div>
        <div class="legend-item"><img src="http://maps.google.com/mapfiles/ms/icons/red-dot.png" class="legend-icon"> 한살림 (남서울)</div>
        <div class="legend-item"><img src="http://maps.google.com/mapfiles/ms/icons/purple-dot.png" class="legend-icon"> 한살림 (동서울)</div>
        <div class="legend-item"><img src="http://maps.google.com/mapfiles/ms/icons/orange-dot.png" class="legend-icon"> 한살림 (서서울)</div>
        <div class="legend-item"><img src="http://maps.google.com/mapfiles/ms/icons/green-dot.png" class="legend-icon"> 한살림 (경인)</div>
        <div class="legend-item" style="margin-top:5px; border-top:1px solid #eee; padding-top:5px;">
            <img src="https://maps.google.com/mapfiles/kml/pal2/icon4.png" class="legend-icon"> 초록마을 (75+)
        </div>
    </div>

    <div id="map"></div>

    <script>
        let map;
        let geocoder;
        const infoWindow = new google.maps.InfoWindow();

        // [1] 한살림 매장 (좌표 고정 - 즉시 로딩)
        const fixedStores = [
            {n:"한살림 미아매장", lat:37.6201, lng:127.0253, type:"hansalim", jibu:"북서울"},
            {n:"한살림 방학매장", lat:37.6635, lng:127.0345, type:"hansalim", jibu:"북서울"},
            {n:"한살림 상계매장", lat:37.6599, lng:127.0718, type:"hansalim", jibu:"북서울"},
            {n:"한살림 쌍문매장", lat:37.6534, lng:127.0371, type:"hansalim", jibu:"북서울"},
            {n:"한살림 창동매장", lat:37.6531, lng:127.0505, type:"hansalim", jibu:"북서울"},
            {n:"한살림 광화문매장", lat:37.5704, lng:126.9698, type:"hansalim", jibu:"북서울"},
            {n:"한살림 개포매장", lat:37.4808, lng:127.0530, type:"hansalim", jibu:"남서울"},
            {n:"한살림 대치매장", lat:37.4962, lng:127.0606, type:"hansalim", jibu:"남서울"},
            {n:"한살림 반포매장", lat:37.5055, lng:127.0068, type:"hansalim", jibu:"남서울"},
            {n:"한살림 서초매장", lat:37.4885, lng:127.0178, type:"hansalim", jibu:"남서울"},
            {n:"한살림 압구정매장", lat:37.5284, lng:127.0375, type:"hansalim", jibu:"남서울"},
            {n:"한살림 가양매장", lat:37.5615, lng:126.8542, type:"hansalim", jibu:"서서울"},
            {n:"한살림 목동매장", lat:37.5285, lng:126.8735, type:"hansalim", jibu:"서서울"},
            {n:"한살림 마포매장", lat:37.5425, lng:126.9399, type:"hansalim", jibu:"서서울"},
            {n:"한살림 성산매장", lat:37.5697, lng:126.9053, type:"hansalim", jibu:"서서울"},
            {n:"한살림 가락매장", lat:37.4925, lng:127.1311, type:"hansalim", jibu:"동서울"},
            {n:"한살림 송파매장", lat:37.5028, lng:127.1168, type:"hansalim", jibu:"동서울"},
            {n:"한살림 잠실매장", lat:37.5095, lng:127.0855, type:"hansalim", jibu:"동서울"},
            // ... (기존 한살림 매장들 유지)
        ];

        // [2] 초록마을 서울 전역 매장 (주소 변환 - 순차 로딩)
        const chorocStores = [
            // --- 강남/서초 ---
            {n:"초록마을 압구정점", a:"서울 강남구 압구정로29길 65"},
            {n:"초록마을 대치점", a:"서울 강남구 선릉로 222"},
            {n:"초록마을 개포점", a:"서울 강남구 개포로82길 9-15"},
            {n:"초록마을 삼성점", a:"서울 강남구 삼성로 517"},
            {n:"초록마을 청담중앙점", a:"서울 강남구 학동로101길 26"},
            {n:"초록마을 도곡점", a:"서울 강남구 언주로30길 26"},
            {n:"초록마을 수서점", a:"서울 강남구 광평로 280"},
            {n:"초록마을 세곡점", a:"서울 강남구 헌릉로569길 23"},
            {n:"초록마을 반포점", a:"서울 서초구 신반포로 177"},
            {n:"초록마을 서초점", a:"서울 서초구 서초중앙로 200"},
            {n:"초록마을 방배점", a:"서울 서초구 방배로 230"},
            {n:"초록마을 서래마을점", a:"서울 서초구 서래로 28"},
            {n:"초록마을 서초교대역점", a:"서울 서초구 서초중앙로 110"},
            {n:"초록마을 우면점", a:"서울 서초구 태봉로 70"},
            {n:"초록마을 서초그랑자이점", a:"서울 서초구 효령로 403"},

            // --- 송파/강동 ---
            {n:"초록마을 잠실리센츠점", a:"서울 송파구 올림픽로 145"},
            {n:"초록마을 헬리오시티점", a:"서울 송파구 송파대로 345"},
            {n:"초록마을 올림픽공원점", a:"서울 송파구 양재대로 1222"},
            {n:"초록마을 송파위례점", a:"서울 송파구 위례광장로 136"},
            {n:"초록마을 문정점", a:"서울 송파구 동남로 123"},
            {n:"초록마을 오금점", a:"서울 송파구 마천로 157"},
            {n:"초록마을 잠실파크리오점", a:"서울 송파구 올림픽로 435"},
            {n:"초록마을 고덕그라시움점", a:"서울 강동구 고덕로 333"},
            {n:"초록마을 명일점", a:"서울 강동구 양재대로 1638"},
            {n:"초록마을 둔촌점", a:"서울 강동구 명일로 172"},
            {n:"초록마을 강일점", a:"서울 강동구 아리수로 423"},
            {n:"초록마을 암사점", a:"서울 강동구 고덕로 52"},

            // --- 마포/서대문/은평 ---
            {n:"초록마을 공덕점", a:"서울 마포구 백범로 152"},
            {n:"초록마을 상암점", a:"서울 마포구 상암산로1길 73"},
            {n:"초록마을 마포염리점", a:"서울 마포구 숭문길 98"},
            {n:"초록마을 성산점", a:"서울 마포구 월드컵북로 235"},
            {n:"초록마을 홍제점", a:"서울 서대문구 통일로 422"},
            {n:"초록마을 북가좌점", a:"서울 서대문구 응암로 79"},
            {n:"초록마을 남가좌점", a:"서울 서대문구 가재울미래로 2"},
            {n:"초록마을 연희점", a:"서울 서대문구 연희맛로 32"},
            {n:"초록마을 은평점", a:"서울 은평구 진관2로 77"},
            {n:"초록마을 녹번역점", a:"서울 은평구 통일로 610"},
            {n:"초록마을 불광점", a:"서울 은평구 불광로 64"},
            {n:"초록마을 구산점", a:"서울 은평구 서오릉로 167"},

            // --- 강서/양천/구로/영등포 ---
            {n:"초록마을 목동점", a:"서울 양천구 목동서로 65"},
            {n:"초록마을 목동롯데캐슬점", a:"서울 양천구 목동중앙북로 38"},
            {n:"초록마을 목동하이페리온점", a:"서울 양천구 오목로 300"},
            {n:"초록마을 신정점", a:"서울 양천구 신월로 338"},
            {n:"초록마을 신월점", a:"서울 양천구 신월로16길 8"},
            {n:"초록마을 강서점", a:"서울 강서구 강서로 351"},
            {n:"초록마을 염창점", a:"서울 강서구 양천로 694"},
            {n:"초록마을 마곡점", a:"서울 강서구 마곡중앙5로 6"},
            {n:"초록마을 화곡점", a:"서울 강서구 강서로33길 16"},
            {n:"초록마을 여의도점", a:"서울 영등포구 국제금융로7길 22"},
            {n:"초록마을 당산점", a:"서울 영등포구 당산로44길 3"},
            {n:"초록마을 문래점", a:"서울 영등포구 선유로 63"},
            {n:"초록마을 구로점", a:"서울 구로구 경인로 482"},
            {n:"초록마을 신도림점", a:"서울 구로구 경인로 661"},

            // --- 성동/광진/동대문/중랑 ---
            {n:"초록마을 서울금호점", a:"서울 성동구 금호로 94"},
            {n:"초록마을 왕십리점", a:"서울 성동구 왕십리로 339"},
            {n:"초록마을 성수점", a:"서울 성동구 성수일로 56"},
            {n:"초록마을 옥수점", a:"서울 성동구 독서당로 208"},
            {n:"초록마을 광장점", a:"서울 광진구 아차산로 477"},
            {n:"초록마을 구의점", a:"서울 광진구 아차산로 363"},
            {n:"초록마을 자양점", a:"서울 광진구 뚝섬로 552"},
            {n:"초록마을 서울장안점", a:"서울 동대문구 답십리로 304"},
            {n:"초록마을 묵동점", a:"서울 중랑구 공릉로 26"},
            {n:"초록마을 신내점", a:"서울 중랑구 신내로 211"},

            // --- 노원/도봉/강북/성북 ---
            {n:"초록마을 중계점", a:"서울 노원구 한글비석로 245"},
            {n:"초록마을 상계점", a:"서울 노원구 노원로 462"},
            {n:"초록마을 공릉점", a:"서울 노원구 공릉로 186"},
            {n:"초록마을 월계점", a:"서울 노원구 초안산로2라길 26"},
            {n:"초록마을 창동점", a:"서울 도봉구 노해로63가길 41"},
            {n:"초록마을 방학점", a:"서울 도봉구 도봉로 684"},
            {n:"초록마을 미아점", a:"서울 강북구 삼양로 242"},
            {n:"초록마을 길음점", a:"서울 성북구 길음로 40"},
            {n:"초록마을 돈암점", a:"서울 성북구 아리랑로 19"},
            {n:"초록마을 성북점", a:"서울 성북구 성북로 63"},

            // --- 용산/종로/중구 ---
            {n:"초록마을 동부이촌점", a:"서울 용산구 이촌로65가길 72"},
            {n:"초록마을 신용산점", a:"서울 용산구 서빙고로 17"},
            {n:"초록마을 한남점", a:"서울 용산구 독서당로 73"},
            {n:"초록마을 경희궁자이점", a:"서울 종로구 송월길 99"},
            {n:"초록마을 평창점", a:"서울 종로구 평창문화로 70"},
            {n:"초록마을 약수점", a:"서울 중구 다산로 115"},

            // --- 동작/관악 ---
            {n:"초록마을 이수역점", a:"서울 동작구 동작대로27길 15"},
            {n:"초록마을 사당점", a:"서울 동작구 동작대로 137"},
            {n:"초록마을 상도점", a:"서울 동작구 상도로 254"},
            {n:"초록마을 흑석점", a:"서울 동작구 서달로 166"},
            {n:"초록마을 대방점", a:"서울 동작구 알마타길 6"},
            {n:"초록마을 신림점", a:"서울 관악구 신림로 366"},
            {n:"초록마을 관악로점", a:"서울 관악구 관악로24길 38"},
            {n:"초록마을 보라매점", a:"서울 영등포구 여의대방로 115"}
        ];

        // [3] 주소 매장 추가 (지오코딩 - 약 60개 추가) - 한살림 추가분
        const hansalimAdd = [
            {n:"한살림 강일매장", a:"서울 강동구 상일로12길 99", type:"hansalim", jibu:"동서울"},
            {n:"한살림 둔촌매장", a:"서울 강동구 강동대로55길 77", type:"hansalim", jibu:"동서울"},
            {n:"한살림 명일매장", a:"서울 강동구 동남로73길 9", type:"hansalim", jibu:"동서울"},
            {n:"한살림 고덕매장", a:"서울 강동구 고덕로 399", type:"hansalim", jibu:"동서울"},
            {n:"한살림 암사매장", a:"서울 강동구 고덕로 109", type:"hansalim", jibu:"동서울"},
            {n:"한살림 신천매장", a:"서울 송파구 올림픽로 435", type:"hansalim", jibu:"동서울"},
            {n:"한살림 오금매장", a:"서울 송파구 마천로 106", type:"hansalim", jibu:"동서울"},
            {n:"한살림 광나루매장", a:"서울 광진구 천호대로 798-1", type:"hansalim", jibu:"동서울"},
            {n:"한살림 구의매장", a:"서울 광진구 광나루로 603", type:"hansalim", jibu:"동서울"},
            {n:"한살림 자양매장", a:"서울 광진구 능동로 50", type:"hansalim", jibu:"동서울"},
            {n:"한살림 우장산매장", a:"서울 강서구 화곡동 1005-21", type:"hansalim", jibu:"서서울"},
            {n:"한살림 마곡매장", a:"서울 강서구 마곡서1로 115-1", type:"hansalim", jibu:"서서울"},
            {n:"한살림 신정매장", a:"서울 양천구 목동서로 397", type:"hansalim", jibu:"서서울"},
            {n:"한살림 오목교매장", a:"서울 양천구 목동서로 256", type:"hansalim", jibu:"서서울"},
            {n:"한살림 공덕매장", a:"서울 마포구 마포대로 156", type:"hansalim", jibu:"서서울"},
            {n:"한살림 아현매장", a:"서울 마포구 마포대로 195", type:"hansalim", jibu:"서서울"},
            {n:"한살림 연희매장", a:"서울 서대문구 연희맛로 34", type:"hansalim", jibu:"서서울"},
            {n:"한살림 홍제매장", a:"서울 서대문구 통일로 348", type:"hansalim", jibu:"서서울"},
            {n:"한살림 가재울매장", a:"서울 서대문구 거북골로 100", type:"hansalim", jibu:"서서울"},
            {n:"한살림 문래매장", a:"서울 영등포구 당산로 34", type:"hansalim", jibu:"서서울"},
            {n:"한살림 보라매매장", a:"서울 영등포구 신길로 29", type:"hansalim", jibu:"서서울"},
            {n:"한살림 여의도매장", a:"서울 영등포구 여의동로 97", type:"hansalim", jibu:"서서울"},
            {n:"한살림 고척매장", a:"서울 구로구 중앙로 100", type:"hansalim", jibu:"서서울"},
            {n:"한살림 공릉매장", a:"서울 노원구 공릉로 188", type:"hansalim", jibu:"북서울"},
            {n:"한살림 중계매장", a:"서울 노원구 한글비석로15길 15", type:"hansalim", jibu:"북서울"},
            {n:"한살림 하계매장", a:"서울 노원구 섬밭로 258", type:"hansalim", jibu:"북서울"},
            {n:"한살림 금호매장", a:"서울 성동구 금호로 100", type:"hansalim", jibu:"북서울"},
            {n:"한살림 행당매장", a:"서울 성동구 행당로 76", type:"hansalim", jibu:"북서울"},
            {n:"한살림 왕십리매장", a:"서울 성동구 상왕십리동 14-15", type:"hansalim", jibu:"북서울"},
            {n:"한살림 길음매장", a:"서울 성북구 길음로 33", type:"hansalim", jibu:"북서울"},
            {n:"한살림 돈암매장", a:"서울 성북구 아리랑로 31-1", type:"hansalim", jibu:"북서울"},
            {n:"한살림 종암매장", a:"서울 성북구 종암로24가길 53", type:"hansalim", jibu:"북서울"},
            {n:"한살림 평창매장", a:"서울 종로구 평창동 158-1", type:"hansalim", jibu:"북서울"},
            {n:"한살림 전농매장", a:"서울 동대문구 한천로 207", type:"hansalim", jibu:"북서울"},
            {n:"한살림 이촌매장", a:"서울 용산구 이촌동 300-268", type:"hansalim", jibu:"북서울"},
            {n:"한살림 신내매장", a:"서울 중랑구 신내로15길 196", type:"hansalim", jibu:"북서울"},
            {n:"한살림 방배매장", a:"서울 서초구 서초대로 118", type:"hansalim", jibu:"남서울"},
            {n:"한살림 새반포매장", a:"서울 서초구 서초중앙로31길 14-13", type:"hansalim", jibu:"남서울"},
            {n:"한살림 역삼매장", a:"서울 강남구 역삼동 786-24", type:"hansalim", jibu:"남서울"},
            {n:"한살림 일원매장", a:"서울 강남구 광평로10길 15", type:"hansalim", jibu:"남서울"},
            {n:"한살림 자곡매장", a:"서울 강남구 자곡로 180", type:"hansalim", jibu:"남서울"},
            {n:"한살림 청담매장", a:"서울 강남구 학동로88길 12", type:"hansalim", jibu:"남서울"},
            {n:"한살림 봉천매장", a:"서울 관악구 양녕로 74", type:"hansalim", jibu:"남서울"},
            {n:"한살림 사당매장", a:"서울 동작구 동작대로29길 69", type:"hansalim", jibu:"남서울"},
            {n:"한살림 상도매장", a:"서울 동작구 상도로37길 79", type:"hansalim", jibu:"남서울"},
            {n:"한살림 금천시흥매장", a:"서울 금천구 시흥동 985-13", type:"hansalim", jibu:"남서울"}
        ];

        // 통합 리스트 (초록마을 + 한살림 추가분)
        const addressStores = [...chorocStores, ...hansalimAdd];

        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 37.5665, lng: 126.9780 },
                zoom: 11,
                mapTypeControl: false,
                streetViewControl: false,
                fullscreenControl: true
            });

            // 1. 고정 핀 즉시 추가
            fixedStores.forEach(s => addMarker(s.lat, s.lng, s));

            // 2. 주소 변환 핀 순차 추가
            geocoder = new google.maps.Geocoder();
            processStores(0);
        }

        // 지오코딩 속도 조절 (초록마을 데이터가 많으므로)
        function processStores(index) {
            const statusBox = document.getElementById('status-msg');
            if (index >= addressStores.length) {
                statusBox.style.opacity = '0';
                setTimeout(() => statusBox.style.display = 'none', 500);
                return;
            }

            statusBox.style.display = 'block';
            statusBox.innerText = `매장 불러오는 중... (${index + 1}/${addressStores.length})`;

            const store = addressStores[index];
            geocoder.geocode({ address: store.a }, (results, status) => {
                if (status === "OK") {
                    const loc = results[0].geometry.location;
                    // 초록마을은 type 속성이 없으므로 자동 할당
                    if (!store.type) store.type = "choroc";
                    addMarker(loc.lat(), loc.lng(), store);
                }
                
                // 80ms 간격으로 빠르게 다음 요청
                setTimeout(() => processStores(index + 1), 80);
            });
        }

        function addMarker(lat, lng, store) {
            let iconUrl;
            let badgeColor;
            
            if (store.type === "hansalim") {
                if (store.jibu === "북서울") { iconUrl = "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"; badgeColor="#3498db"; }
                else if (store.jibu === "남서울") { iconUrl = "http://maps.google.com/mapfiles/ms/icons/red-dot.png"; badgeColor="#e74c3c"; }
                else if (store.jibu === "동서울") { iconUrl = "http://maps.google.com/mapfiles/ms/icons/purple-dot.png"; badgeColor="#9b59b6"; }
                else if (store.jibu === "서서울") { iconUrl = "http://maps.google.com/mapfiles/ms/icons/orange-dot.png"; badgeColor="#f39c12"; }
                else { iconUrl = "http://maps.google.com/mapfiles/ms/icons/green-dot.png"; badgeColor="#1abc9c"; }
            } else {
                iconUrl = "https://maps.google.com/mapfiles/kml/pal2/icon4.png"; // 초록마을
                badgeColor = "#27ae60";
            }

            const marker = new google.maps.Marker({
                position: { lat: lat, lng: lng },
                map: map,
                title: store.n,
                icon: iconUrl
            });

            marker.addListener("click", () => {
                const content = `
                    <div style="padding:5px; min-width:160px;">
                        <h3 style="margin:0 0 5px 0; font-size:15px;">${store.n}</h3>
                        <span style="background-color:${badgeColor}; color:white; padding:3px 6px; border-radius:4px; font-size:11px;">
                            ${store.type === 'hansalim' ? store.jibu : '초록마을'}
                        </span>
                        <div style="font-size:12px; margin-top:5px; color:#666;">
                            ${store.a ? store.a : ''}
                        </div>
                    </div>
                `;
                infoWindow.setContent(content);
                infoWindow.open(map, marker);
            });
        }
        
        window.onload = initMap;
    </script>
</body>
</html>