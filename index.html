<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>한살림 서울 지부별 전체 매장 지도</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCd6QIRzWvsTTbfVUQkcqGyz-fXuQ4DTbU&libraries=geometry"></script>
    <style>
        html, body { margin: 0; padding: 0; height: 100%; font-family: 'Malgun Gothic', sans-serif;}
        #map { width: 100%; height: 100%; }
        
        #status-bar {
            position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
            z-index: 1000; background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px; border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); font-weight: bold; font-size: 14px;
        }

        .legend {
            position: absolute; bottom: 30px; right: 10px; z-index: 1000;
            background: white; padding: 10px; border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3); font-size: 12px;
            max-height: 300px; overflow-y: auto;
        }
        .legend-item { display: flex; align-items: center; margin-bottom: 5px; cursor: pointer; }
        .legend-icon { width: 20px; height: 20px; margin-right: 5px; }
    </style>
</head>
<body>
    <div id="status-bar">지도 데이터 로딩 중...</div>
    
    <div class="legend">
        <div class="legend-item"><img src="http://maps.google.com/mapfiles/ms/icons/red-dot.png" class="legend-icon">남부 (강남/서초)</div>
        <div class="legend-item"><img src="http://maps.google.com/mapfiles/ms/icons/orange-dot.png" class="legend-icon">서서울 (강서/동작/광명)</div>
        <div class="legend-item"><img src="http://maps.google.com/mapfiles/ms/icons/purple-dot.png" class="legend-icon">동부 (송파/강동/하남)</div>
        <div class="legend-item"><img src="http://maps.google.com/mapfiles/ms/icons/blue-dot.png" class="legend-icon">북동 (성북/광진/구리)</div>
        <div class="legend-item"><img src="http://maps.google.com/mapfiles/ms/icons/green-dot.png" class="legend-icon">중서 (마포/종로/은평)</div>
        <div class="legend-item"><img src="http://maps.google.com/mapfiles/ms/icons/pink-dot.png" class="legend-icon">북부 (노원/도봉/남양주)</div>
    </div>

    <div id="map"></div>

    <script>
        let map;
        let geocoder;
        const geocodedStores = []; 
        
        // 지부별 매장 데이터 (서울+인근 경기 포함 약 70여개)
        const stores = [
            // 1. 남부지부 (강남, 서초) - 빨강
            {name: "개포매장", address: "서울 강남구 개포로 265", jibu: "남부"},
            {name: "대치매장", address: "서울 강남구 삼성로51길 11", jibu: "남부"},
            {name: "압구정매장", address: "서울 강남구 압구정로 309", jibu: "남부"},
            {name: "역삼매장", address: "서울 강남구 논현로72길 16", jibu: "남부"},
            {name: "일원매장", address: "서울 강남구 광평로10길 15", jibu: "남부"},
            {name: "청담매장", address: "서울 강남구 학동로88길 12", jibu: "남부"},
            {name: "자곡매장", address: "서울 강남구 자곡로 180", jibu: "남부"},
            {name: "반포매장", address: "서울 서초구 신반포로 177", jibu: "남부"},
            {name: "방배매장", address: "서울 서초구 서초대로 118", jibu: "남부"},
            {name: "잠원매장", address: "서울 서초구 신반포로 219", jibu: "남부"},
            {name: "서초매장", address: "서울 서초구 서초대로 3-4", jibu: "남부"},

            // 2. 서서울지부 (강서, 양천, 구로, 영등포, 동작, 관악, 광명) - 주황
            {name: "가양매장", address: "서울 강서구 공항대로55길 47", jibu: "서서울"},
            {name: "마곡매장", address: "서울 강서구 마곡서로 101", jibu: "서서울"},
            {name: "우장산매장", address: "서울 강서구 강서로 242", jibu: "서서울"}, // 화곡
            {name: "목동매장", address: "서울 양천구 목동동로 339", jibu: "서서울"},
            {name: "신정매장", address: "서울 양천구 목동서로 401", jibu: "서서울"},
            {name: "고척매장", address: "서울 구로구 중앙로 100", jibu: "서서울"},
            {name: "금천시흥매장", address: "서울 금천구 시흥대로77길 32", jibu: "서서울"},
            {name: "문래매장", address: "서울 영등포구 당산로 34", jibu: "서서울"},
            {name: "보라매매장", address: "서울 영등포구 신길로 29", jibu: "서서울"},
            {name: "여의도매장", address: "서울 영등포구 여의대방로 383", jibu: "서서울"},
            {name: "상도매장", address: "서울 동작구 상도로37길 79", jibu: "서서울"},
            {name: "봉천매장", address: "서울 관악구 양녕로 74", jibu: "서서울"},
            {name: "철산매장", address: "경기 광명시 철산로 45", jibu: "서서울"},
            {name: "하안매장", address: "경기 광명시 하안로 288", jibu: "서서울"},
            {name: "화정매장", address: "경기 고양시 덕양구 화신로272번길 29", jibu: "서서울"}, // 고양 인근 포함

            // 3. 동부지부 (강동, 송파, 하남) - 보라
            {name: "강일매장", address: "서울 강동구 상일로12길 99", jibu: "동부"},
            {name: "둔촌매장", address: "서울 강동구 강동대로55길 77", jibu: "동부"},
            {name: "명일매장", address: "서울 강동구 동남로71길 24", jibu: "동부"},
            {name: "암사매장", address: "서울 강동구 고덕로 109", jibu: "동부"},
            {name: "고덕매장", address: "서울 강동구 고덕로 399", jibu: "동부"},
            {name: "송파매장", address: "서울 송파구 송이로 27", jibu: "동부"},
            {name: "가락매장", address: "서울 송파구 오금로46길 68", jibu: "동부"},
            {name: "잠실매장", address: "서울 송파구 백제고분로 150", jibu: "동부"},
            {name: "잠실새내역매장", address: "서울 송파구 석촌호수로 61", jibu: "동부"},
            {name: "오금매장", address: "서울 송파구 마천로 106", jibu: "동부"},
            {name: "위례매장", address: "경기 성남시 수정구 위례동로 61", jibu: "동부"},
            {name: "하남매장", address: "경기 하남시 신장동로29번길 40", jibu: "동부"},
            {name: "미사매장", address: "경기 하남시 미사강변중앙로 220", jibu: "동부"},

            // 4. 북동지부 (동대문, 성북, 성동, 광진, 구리) - 파랑
            {name: "광나루매장", address: "서울 광진구 천호대로 798-1", jibu: "북동"},
            {name: "구의매장", address: "서울 광진구 광나루로 603", jibu: "북동"},
            {name: "자양매장", address: "서울 광진구 능동로 50", jibu: "북동"},
            {name: "구리매장", address: "경기 구리시 장자대로86번길 38", jibu: "북동"},
            {name: "인창매장", address: "경기 구리시 건원대로34번길 19", jibu: "북동"},
            {name: "금호매장", address: "서울 성동구 금호로 102", jibu: "북동"},
            {name: "행당매장", address: "서울 성동구 행당로 76", jibu: "북동"},
            {name: "길음매장", address: "서울 성북구 길음로 11", jibu: "북동"},
            {name: "돈암매장", address: "서울 성북구 아리랑로 31-1", jibu: "북동"},
            {name: "종암매장", address: "서울 성북구 종암로24가길 53", jibu: "북동"},
            {name: "전농매장", address: "서울 동대문구 사가정로 148", jibu: "북동"},

            // 5. 중서지부 (마포, 서대문, 용산, 은평, 종로, 중구) - 초록
            {name: "광화문매장", address: "서울 종로구 경희궁길 15", jibu: "중서"},
            {name: "구파발매장", address: "서울 은평구 진관3로 15-35", jibu: "중서"},
            {name: "불광매장", address: "서울 은평구 통일로 738", jibu: "중서"},
            {name: "마포매장", address: "서울 마포구 토정로 269", jibu: "중서"},
            {name: "성산매장", address: "서울 마포구 월드컵북로 216", jibu: "중서"},
            {name: "아현매장", address: "서울 마포구 마포대로 195", jibu: "중서"},
            {name: "공덕매장", address: "서울 마포구 마포대로 156", jibu: "중서"},
            {name: "연희매장", address: "서울 서대문구 연희맛로 34", jibu: "중서"},
            {name: "홍제매장", address: "서울 서대문구 통일로 348", jibu: "중서"},
            {name: "가재울매장", address: "서울 서대문구 거북골로 100", jibu: "중서"},
            {name: "이촌매장", address: "서울 용산구 이촌로 248", jibu: "중서"},

            // 6. 북부지부 (도봉, 노원, 강북, 의정부, 양주, 남양주) - 분홍
            {name: "방학매장", address: "서울 도봉구 도봉로150다길 28", jibu: "북부"},
            {name: "쌍문매장", address: "서울 도봉구 시루봉로 139", jibu: "북부"},
            {name: "창동매장", address: "서울 도봉구 마들로 556", jibu: "북부"},
            {name: "상계매장", address: "서울 노원구 노원로 526", jibu: "북부"},
            {name: "중계매장", address: "서울 노원구 한글비석로8길 29", jibu: "북부"},
            {name: "하계매장", address: "서울 노원구 섬밭로 258", jibu: "북부"},
            {name: "공릉매장", address: "서울 노원구 공릉로 188", jibu: "북부"},
            {name: "미아매장", address: "서울 강북구 삼양로27길 45", jibu: "북부"},
            {name: "의정부매장", address: "경기 의정부시 추동로91번길 15", jibu: "북부"},
            {name: "양주고읍매장", address: "경기 양주시 고읍남로 39", jibu: "북부"},
            {name: "다산매장", address: "경기 남양주시 다산순환로 397-47", jibu: "북부"},
            {name: "호평매장", address: "경기 남양주시 호평로46번안길 4-21", jibu: "북부"},
            {name: "별내매장", address: "경기 남양주시 별내중앙로 36-31", jibu: "북부"},
            {name: "신내매장", address: "서울 중랑구 신내로21길 16", jibu: "북부"}
        ];

        const jibuIcons = {
            "남부": "http://maps.google.com/mapfiles/ms/icons/red-dot.png",   // 빨강
            "북동": "http://maps.google.com/mapfiles/ms/icons/blue-dot.png",   // 파랑
            "중서": "http://maps.google.com/mapfiles/ms/icons/green-dot.png",   // 초록
            "서서울": "http://maps.google.com/mapfiles/ms/icons/orange-dot.png", // 주황
            "동부": "http://maps.google.com/mapfiles/ms/icons/purple-dot.png",   // 보라
            "북부": "http://maps.google.com/mapfiles/ms/icons/pink-dot.png"    // 분홍
        };

        function initMap() {
            // 지도 스타일: 전철(transit)과 POI(상가, 관공서 등 아이콘) 모두 숨기기
            const mapStyles = [
                {
                    featureType: "transit", // 전철 및 교통 노선
                    stylers: [{ visibility: "off" }]
                },
                {
                    featureType: "poi", // 포인트 오브 인터레스트 (상점, 학교 등 아이콘)
                    elementType: "labels", // 라벨(아이콘+글자) 숨김
                    stylers: [{ visibility: "off" }]
                }
            ];

            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 37.5665, lng: 126.9780 },
                zoom: 11,
                styles: mapStyles,
                disableDefaultUI: false, // 기본 UI 유지
                zoomControl: true
            });
            geocoder = new google.maps.Geocoder();
            processNext(0);
        }

        function processNext(index) {
            const statusBar = document.getElementById("status-bar");
            
            if (index >= stores.length) {
                statusBar.style.display = "none";
                return;
            }

            const store = stores[index];
            statusBar.innerText = `매장 로딩 중 (${index + 1}/${stores.length}): ${store.name} (${store.jibu})`;

            geocoder.geocode({ address: store.address }, (results, status) => {
                if (status === "OK") {
                    const location = results[0].geometry.location;
                    const iconUrl = jibuIcons[store.jibu];
                    
                    const storeData = {
                        name: store.name,
                        address: store.address,
                        jibu: store.jibu,
                        location: location,
                        marker: null
                    };

                    const marker = new google.maps.Marker({
                        map: map,
                        position: location,
                        title: store.name, 
                        icon: iconUrl
                    });
                    
                    storeData.marker = marker;
                    geocodedStores.push(storeData);

                    const infoWindow = new google.maps.InfoWindow();
                    marker.addListener("click", () => {
                        let content = `<div style="padding:5px; min-width:220px; color:black;">
                                        <h3 style="margin:0 0 5px 0;">${store.name} 
                                            <span style="font-size:12px; font-weight:normal; color:#555;">(${store.jibu}지부)</span>
                                        </h3>
                                        <div style="font-size:12px; color:#666; margin-bottom:8px;">${store.address}</div>
                                        <hr style="border:0; border-top:1px solid #ddd; margin:5px 0;">
                                        <strong>[${store.jibu}지부 내 가까운 매장]</strong><br>
                                        <div style="max-height:120px; overflow-y:auto; font-size:12px; line-height:1.6;">`;

                        const neighbors = geocodedStores.filter(s => s.jibu === store.jibu && s.name !== store.name);
                        
                        if (neighbors.length > 0) {
                            neighbors.sort((a, b) => {
                                const distA = google.maps.geometry.spherical.computeDistanceBetween(location, a.location);
                                const distB = google.maps.geometry.spherical.computeDistanceBetween(location, b.location);
                                return distA - distB;
                            });

                            neighbors.forEach(neighbor => {
                                const distanceMeters = google.maps.geometry.spherical.computeDistanceBetween(location, neighbor.location);
                                const distanceKm = (distanceMeters / 1000).toFixed(2);
                                content += `${neighbor.name}: <b>${distanceKm}km</b><br>`;
                            });
                        } else {
                            content += "데이터 로딩 중...<br>";
                        }
                        
                        content += `</div></div>`;
                        infoWindow.setContent(content);
                        infoWindow.open(map, marker);
                    });

                } else {
                    console.error("Geocode error for " + store.name + ": " + status);
                }

                // API 할당량 보호를 위해 속도 조절
                setTimeout(() => processNext(index + 1), 100); 
            });
        }

        window.onload = initMap;
    </script>
</body>
</html>
